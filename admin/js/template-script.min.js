jQuery(document).ready(function(e) {
    jQuery("body").append('<div id="overlay_dialog" style="display:none;"></div>'), jQuery(document).on("click", ".delete_current_template", function() {
        jQuery(this).parent().remove()
    }), jQuery(".add_order_note").click(function() {
        var e = "<div class='template_notes div_block'><span class='dashicons dashicons-minus delete_current_template' ></span><div class='template_div'><input placeholder = 'Enter order note title' class = 'template_title' required/> <select class='note_type' required > <option value = 'customer' >Customer Note</option><option value = 'private' >Private Note</option></select><textarea class='template_block_area' placeholder = 'Enter content' required></textarea></div> </div>";
        jQuery(".main_template_block").append(e)
    });
    var r = [];
    jQuery(".save_template").click(function() {
        if ( fail = !1, jQuery("div.template_div input").each(function() {
            jQuery(this).prop("required") && (jQuery(this).val() ? e.isNumeric(jQuery(this).val()) && jQuery(this).hasClass("template_title") ? jQuery(this).hasClass("error") || (jQuery(this).after('<span class="error-msg" style="display: block;">* Invalid title.</span>'), jQuery(this).addClass("error")) : (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove()) : ( fail = !0, jQuery(this).hasClass("error") || (jQuery(this).after('<span class="error-msg" style="display: block;">* Required field.</span>'), jQuery(this).addClass("error"))))
        }), jQuery("div.template_div select").each(function() {
            jQuery(this).prop("required") && (jQuery(this).val() ? (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove()) : ( fail = !0, jQuery(this).hasClass("error") || (jQuery(this).after('<span class="error-msg" style="display: block;">* Required field.</span>'), jQuery(this).addClass("error"))))
        }), jQuery("div.template_div textarea").each(function() {
            jQuery(this).prop("required") && (jQuery(this).val() ? e.isNumeric(jQuery(this).val()) ? ( fail = !0, jQuery(this).hasClass("error") || (jQuery(this).after('<span class="error-msg" style="display: block;">* Invalid note.</span>'), jQuery(this).addClass("error"))) : (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove()) : ( fail = !0, jQuery(this).hasClass("error") || (jQuery(this).after('<span class="error-msg" style="display: block;">* Required field.</span>'), jQuery(this).addClass("error"))))
        }), !fail) {
            var t = [], a = [], s = [], o = [], l = !1, i = "";
            jQuery(".template_title")[0] ? (jQuery(".template_title").each(function() {
                jQuery(this).val() ? t.push(jQuery(this).val()) : ( l = !0, jQuery(".template_div div").find(".error-msg").length || (jQuery(this).addClass(""), jQuery(this).parent().append(i)))
            }), t.length && l === !1 ? (jQuery(".post_id").each(function() {
                o.push(jQuery(this).val())
            }), jQuery(".note_type").each(function() {
                a.push(jQuery(this).val())
            }), jQuery(".template_block_area").each(function() {
                s.push(jQuery(this).val())
            }), jQuery.ajax({
                url : ajaxurl,
                data : {
                    action : "wont_save_templates",
                    post_id : o,
                    template_title : t,
                    template_text : s,
                    note_type : a,
                    note_delete : r,
                    security : gyrixnonce.ajaxSave
                },
                type : "POST",
                success : function(e) {
                    0 == e ? alert("Not updated") : (alert("Updated Successfully"), location.reload())
                }
            })) : l === !1 && jQuery(".template_title").each(function() {
                "" == jQuery(this).val() && (jQuery(".template_title").addClass("error"), jQuery(this).parent().append(i))
            })) : jQuery.ajax({
                url : ajaxurl,
                data : {
                    action : "wont_save_templates",
                    note_delete : r,
                    security : gyrixnonce.ajaxSave
                },
                type : "POST",
                success : function(e) {
                    0 == e ? alert("Not updated") : (alert("Deleted Successfully"), jQuery(".add_order_note").click())
                }
            })
        }
    }), jQuery(".delete_current_template").on("click", function() {
        r.push(parseInt(jQuery(this).parent().find(".post_id").val()))
    }), jQuery(".note_type").on("click", function() {
        jQuery("option:selected", this).attr("selected", !0).siblings().removeAttr("selected")
    }), jQuery(".shop_order-note").click(function(r) {        
        r.preventDefault(), jQuery("#overlay_dialog").show(), jQuery("#customer_name").addClass("loadinggif");
        var a = jQuery(this).closest("tr").attr("id").split("-");
        a = a[1], jQuery("input#order_post_id").val(a), jQuery("input#customer_name").val(""), jQuery.ajax({
            url : ajaxurl,
            data : {
                action : "wont_gyrix_customer_name",
                post_id : a,
                security : gyrixnonce.ajaxGet
            },
            type : "POST",
            success : function(e) {
                e && (jQuery("input#customer_name").removeClass("loadinggif"), e = jQuery.parseJSON(e), jQuery("input#customer_name").val(e))
            },
            error : function(e) {
                console.log(e)
            }
        }), dialog = jQuery("#dialog").dialog({
            buttons : {
                "Add Note" : function() {
                    validated = 1;
                    var note_typ = "";
                    var note_msg = "";
                    noteType = jQuery('#added_note_type').val();
                    note_msg = jQuery("textarea#add_order_note_text").val();
                    if(!noteType)
                    {
                        validated = 0;
                        jQuery('.error_note').show()
                    }
                    if(!note_msg || note_msg == "" || note_msg == " ")
                    {
                        validated = 0;
                        jQuery('.error_note_txt').show()
                    }
                    if(validated)
                    {
                        jQuery(".wont_overlay_note").show()
                        jQuery(".wont_img_loader").show()
                        jQuery('.error_note_txt').hide()
                        jQuery('.error_note').hide()
                        jQuery(".ui-dialog-buttonpane").css("pointer-events", "none");
                        jQuery(".wait_msg").show();
                        var r = "";
                        r = jQuery("#order_post_id").val(), 
                        jQuery.ajax({
                            url : ajaxurl,
                            data : {
                                action : "wont_gyrix_add_note",
                                post_id : r,
                                note : note_msg,
                                note_type : noteType,
                                security : gyrixnonce.ajaxAdd
                            },
                            type : "POST",
                            success : function(e) {
                                jQuery(".wont_overlay_note").hide()
                        jQuery(".wont_img_loader").hide()
                                0 == e ? alert("Not validate") : e && (alert("A note added to the order Successfully"), jQuery(".ui-dialog-buttonpane").css("pointer-events", "all"), jQuery(".ui-dialog-titlebar-close").click(), dialog.dialog("close"), window.location.reload())
                            },
                            error : function(e) {
                                console.log(e)
                            }
                        })
                   }
                },
                Cancel : function() {
                    jQuery("#customer_name").empty(), jQuery("#order_post_id").empty(), jQuery("#add_order_note_type").val(""), jQuery("#add_order_note_text").val(""), jQuery("#overlay_dialog").hide(), dialog.dialog("close")
                }
            }
        }), jQuery(".ui-dialog-titlebar-close").on("click", function() {
            jQuery("#customer_name").empty(), jQuery("#order_post_id").empty(), jQuery("#add_order_note_type").val(""), jQuery("#add_order_note_text").val(""), jQuery("#overlay_dialog").hide()
        })
    }), jQuery(document).on("change", "#add_order_note_type", function() {
        jQuery('.error_note_txt').hide()
                        jQuery('.error_note').hide()
        jQuery(this).hasClass("error") && (jQuery(this).removeClass("error"), jQuery(this).next("span").remove()), jQuery("option:selected", this).attr("selected", !0).siblings().removeAttr("selected");
        var e = jQuery(this).children(":selected").attr("id");
        if (jQuery("#gyrix_content-" + e).text()) {
            var r = jQuery("#gyrix_content-" + e).text();
            jQuery(this).closest("div").find("#order_post_id").val(), r && (jQuery("textarea#add_order_note_text").text(r), jQuery("textarea#add_order_note_text").removeClass("error"), jQuery("textarea#add_order_note_text").val(r))
        }
        var t = jQuery(this).children(":selected").val();
        jQuery("#added_note_type").val(t)
    }), jQuery(document).on("keypress", "#add_order_note_text", function(e) {
        jQuery(this).val() ? (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove()) : (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove())
    })
}), jQuery(document).on("keypress", ".template_title,.template_block_area", function(e) {
    jQuery(this).val() ? (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove()) : (jQuery(this).removeClass("error"), jQuery(this).next("span").hasClass("error-msg") && jQuery(this).next("span").remove())
}); 